---
title: eNSP配置OSPF协议
comments: true
donate: true
tags: OSPF技术
categories: 网络技术
description: 如何在华为eNSP中配置OSPF动态路由协议.
sticky: 
abbrlink: 3401392151
date: 2024-06-09 00:00:00
from:
url:
author:
about:
avatar:
---
# OSPF动态路由协议

### OSPF协议
开放式最短路径优先协议OSPF(Open Shortest Path Fisrt)是IETF定义的一种基于链路状态（包括带宽和距离）的内部网关路由协议，是现阶段常用的路由协议，OSPF默认优先级是10。而动态路由RIP是一种基于距离矢量算法的路由协议，RIP的优先级是100，存在着收敛慢、易产生路由环路、可扩展性差等问题，目前已逐渐被OSPF取代。
### OSPF的工作原理
每个路由器回周期性的向相邻路由器发送探测报文（Hello 报文），检测其是否可达。如果邻站给予应答，说明链路正常；否则说明链路出现故障。如果一个路由器检测到某条链路状态协议发生变化，该路由器就发送链路状态更新报文，采用泛洪操作对全网更新链路状态。即使链路状态没有发生变化，每隔 30min 路由器要向网络中的其他路由器广播链路状态信息，以保证链路状态数据库和全网保持一致。每个路由器收到其他路由器的链路状态信息后，更新链路状态数据库，构建整个网络的拓扑图，利用 Dijkstra 的最短路径算法计算出到达每个网络的最短路径（就是路由表中的内容）。
### OSPF区域规划
Area 0 是骨干区域、核心区域，Area 1、2 等是常规区域，其他常规区域都必须与此相连。
OSPF区域：每个区域都维护一个独立的链路装填数据LSDB（Link State Database）。
区域边界路由器ABR（Area Border Router）:既连接骨干区域，也连接常规区域。

### OSPF的优势：

1. 无环路，OSPF是基于链路状态算法的，链路状态算法本身就是没有环路。

2. 收敛快，理论上可以实现纳秒级收敛，只不过设备性能无法支持纳秒级，最多能形成毫秒级收敛。

3. 扩展性好

4. 支持认证，两台路由器之间配置了认证后，如果认证通过才会交互路由信息，如果不通过不交互。不过我们这个实验不做这个认证，大家了解一下就行。

## 配置过程及讲解
配置R1的OSPF协议
```
[R1]ospf 1 #配置OSPF进程号
[R1-ospf-1]area 0 #设置为主干区域0
[R1-ospf-1-area-0.0.0.0]network [ip网段] [反子网掩码]  #（宣告网段）告诉所有相连接的路由器，本路由器下有几个网段
反子网掩码：顾名思义就是和平时写的子网掩码相反,平时255时反码就是0 平时0时反码就是255（0表示精确匹配，1表示任意匹配。）
```
>提示：在平时配置中要使用OSPF应当在拓扑中所有路由器上配置OSPF协议，使它们通信。

## 查看OSPF邻接表
display ospf peer brief #显示OSPF邻居表

## OSPF额外补充
OSPF常见的五种报文:DBD、LSR、LSU、LSack和Hello报文。

1. Hello报文（Hello Packet）：
  -  目的：用于在OSPF路由器之间建立和维护邻居关系。Hello报文帮助路由器发现和保持邻居，确保它们在同一个子网中。
  -  特点：定期发送，包含诸如路由器ID、Hello间隔时间、邻居列表等信息。

2. 数据库描述报文（DBD Packet，也称为DD报文）：
  -  目的：用于在邻居之间交换LSA（链路状态广告）摘要，帮助路由器了解邻居路由器的链路状态数据库。
  -  特点：包含LSA的简要信息（如LSA头部），以便双方比较和同步它们的数据库。

3. 链路状态请求报文（LSR Packet）：
  -  目的：用于请求特定的LSA详细信息。如果一个路由器发现邻居有它自己没有的LSA，它会发送LSR请求这些LSA。
  -  特点：包含请求的LSA的类型、ID等信息。

4. 链路状态更新报文（LSU Packet）：
  -  目的：用于发送详细的LSA信息。响应LSR报文，或者在链路状态发生变化时，路由器会发送LSU报文来更新邻居的链路状态数据库。
  -  特点：包含一个或多个LSA的完整信息。

5. 链路状态确认报文（LSAck Packet）：
  -  目的：用于确认收到的LSA。为了确保可靠传输，每个LSA都需要确认。LSAck报文用于确认收到的LSA，防止信息丢失。
  -  特点：包含被确认的LSA的头部信息。
